"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[572],{43572:function(e,n,r){r.r(n),r.d(n,{default:function(){return no}});var i=r(47568),t=r(26042),s=r(70655),a=r(85893),l=r(67294),o=r(98615),c=r(40226),d=r(90450),u=r(77310),x=r(96322),p=r(89250),h=r(30120),m=r(62097),j=r(50880),f=r(46366),g=r(2316),b=r(68415),v=r(55044),Z=r(8151),y=r(22133),_=r(5204),C=r(69396),w=r(828),P=r(12599),k=r(25980),S=r(83101),R=r(54129),E=r(73850),D=r(57290),T=r(29332),W=r(18123),A=r(31538),L=r(80562),N=r(73812),I=r(29630),z=r(60684),O=r(68195),M=r(99534),F=r(75297),B=r(46661),q=r(43322),H=r(83983),J=r(60703),Y=r(9144),G=r(50594),X=function(e){var n=e.onCancel;return(0,M.Z)(e,["onCancel"]),(0,a.jsx)(F.p,{resource:"role",children:(0,a.jsx)(Y.Z,{sx:{marginTop:"40px"},direction:"column",p:1,children:(0,a.jsxs)(v.x0,{children:[(0,a.jsx)(L.Z,{onClick:n,size:"small",children:(0,a.jsx)(G.Z,{})}),(0,a.jsx)(I.Z,{color:"primary",component:"h5",variant:"h5",align:"left",children:"Edit Role"}),(0,a.jsxs)(B.l,{children:[(0,a.jsx)(q.o,{label:"Name",margin:"normal",source:"name",required:!0,fullWidth:!0}),(0,a.jsx)(q.o,{label:"Login",margin:"normal",source:"login",required:!0,fullWidth:!0,disabled:!0}),(0,a.jsx)(H.u,{margin:"normal",source:"classes.classid",reference:"role_class",children:(0,a.jsx)(J.s,{margin:"normal",label:"Role Classes",optionText:"name",fullWidth:!0})}),(0,a.jsx)(v.Nw,{onCancel:n})]})]})})})},U=function(e){var n=e.onCancel;return(0,M.Z)(e,["onCancel"]),(0,a.jsx)(F.p,{resource:"role_class",children:(0,a.jsx)(Y.Z,{sx:{marginTop:"40px"},direction:"column",p:1,children:(0,a.jsxs)(v.x0,{children:[(0,a.jsx)(L.Z,{onClick:n,size:"small",children:(0,a.jsx)(G.Z,{})}),(0,a.jsx)(I.Z,{color:"primary",component:"h5",variant:"h5",align:"left",children:"Edit Role Class"}),(0,a.jsxs)(B.l,{children:[(0,a.jsx)(q.o,{label:"Class Name",margin:"normal",source:"name",required:!0,fullWidth:!0}),(0,a.jsx)(v.Nw,{onCancel:n})]})]})})})},Q=function(e){var n=(0,p.s0)(),r=(0,p.TH)(),i=function(e){var r=(0,w.Z)(l.useState(null),2),i=r[0],t=r[1],s=function(e){t(e.currentTarget)},o=function(){t(null)},c=function(e){var r=(0,k.j)(),i=function(){switch(t(null),e.id){case"edit_role":n("role/".concat(r.id),{replace:!0});break;case"edit_role_class":n("role_class/".concat(r.id),{replace:!0});break;case"role_class_members":console.log("Filter role table by classid")}};return(0,a.jsx)(A.Z,{component:"a",onClick:i,children:e.label},e.id)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.Z,{onClick:s,sx:{p:0},children:(0,a.jsx)(O.Z,{})}),(0,a.jsx)(N.Z,{sx:{mt:"25px"},id:"menu_user_actions",anchorEl:i,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(i),onClose:o,children:function(e){switch(e){case"role":return(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{id:"edit_role",component:"a",label:"Edit Role"}),(0,a.jsx)(c,{id:"reset_password",component:"a",label:"Change Password"}),(0,a.jsx)(c,{id:"delete_role",component:"a",label:"Delete Role"})]},e);case"role_class":return(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{id:"role_class_members",component:"a",label:"Members"}),(0,a.jsx)(c,{id:"edit_role_class",component:"a",label:"Edit Class"}),(0,a.jsx)(c,{id:"delete_role_class",component:"a",label:"Delete Class"})]},e)}}(e.resource)})]})},s=(0,l.useCallback)(function(){n("/role_management")},[n]),o=(0,P.LX)("role_management/role/:id",r.pathname),c=(0,P.LX)("role_management/role_class/:id",r.pathname);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(v.x0,{sx:{width:"520px",marginBottom:5,p:4},children:[(0,a.jsx)(I.Z,{color:"primary",component:"p",variant:"h5",align:"left",display:"block",gutterBottom:!0,children:"Role Classes"}),(0,a.jsx)(S.a,(0,C.Z)((0,t.Z)({resource:"role_class"},e),{pagination:(0,a.jsx)(v.dl,{}),actions:(0,a.jsx)(v.RY,{refresh:!1,export:!1,title:"Role Classes",filters:{main:"name"}}),children:(0,a.jsxs)(R.c,{optimized:!0,bulkActionButtons:!1,sx:{"& .RaDatagrid-thead":{display:"none"}},children:[(0,a.jsx)(E.n,{label:"",source:"name"}),(0,a.jsx)(i,{resource:"role_class"})]})}))]}),(0,a.jsx)(z.ZP,{PaperProps:{sx:{width:"20%"}},variant:"persistent",open:!!c,anchor:"right",onClose:s,sx:{zIndex:100,width:100},children:!!c&&(0,a.jsx)(U,(0,t.Z)({id:c.params.id,onCancel:s},e))}),(0,a.jsxs)(v.x0,{sx:{p:4},children:[(0,a.jsx)(I.Z,{color:"primary",component:"p",variant:"h5",align:"left",display:"block",gutterBottom:!0,children:"Roles"}),(0,a.jsx)(S.a,(0,C.Z)((0,t.Z)({resource:"role"},e),{pagination:(0,a.jsx)(v.dl,{}),actions:(0,a.jsx)(v.RY,{refresh:!1,export:!1,title:"Role Classes",filters:{main:"name"}}),children:(0,a.jsxs)(R.c,{optimized:!0,bulkActionButtons:!1,children:[(0,a.jsx)(E.n,{label:"Role ID",source:"id"}),(0,a.jsx)(E.n,{label:"Name",source:"name"}),(0,a.jsx)(E.n,{label:"Login",source:"login"}),(0,a.jsx)(D.J,{label:"",render:function(e){return(0,a.jsx)(v.sZ,{label:(0,a.jsxs)("span",{children:["Role Classes"," ",(0,a.jsx)(L.Z,{children:e.classes.length})]}),disabled:!e.classes.length,color:"info"})}}),(0,a.jsx)(T.je,{label:"Creator",source:"creatorid",reference:"role",link:!1,children:(0,a.jsx)(E.n,{source:"name"})}),(0,a.jsx)(W.N,{label:"Created",source:"createtime"}),(0,a.jsx)(i,{resource:"role"})]})}))]}),(0,a.jsx)(z.ZP,{PaperProps:{sx:{width:"20%"}},variant:"persistent",open:!!o,anchor:"right",onClose:s,sx:{zIndex:100,width:100},children:!!o&&(0,a.jsx)(X,(0,t.Z)({id:o.params.id,onCancel:s},e))})]})},V=r(52037),$=r(66596),K=r(78863),ee=r(74011),en=r(27682),er=r(94889),ei=r(19718),et=r(1890),es=r(77745),ea=r(95398),el=r(44731),eo=r(79072),ec=r(75084),ed=r(649),eu=r(62619),ex=r(93293),ep=[".svg",".png",".jpg",".gif",".jpeg"],eh=function(e){var n=e.onCancel,r=(0,l.useState)(null),i=r[0],t=r[1],s=(0,$.d)(),o=function(){i?console.log("upload profile iamge"):(0,ex.v5)(s,"Please load your profile image","info")},c=function(e){var n,r=e[0],i=r.size,a=r.name;ep.some(function(e){var n=/[.]/.exec(a)?/[^.]+$/.exec(a):void 0;return(null==n?void 0:n[0].toLowerCase())===e.split(".").pop()})?i/1024/1024<=1?((0,ex.v5)(s,"Success to load your profile image","success"),t(e)):((0,ex.v5)(s,"File exceeds the 1MB size limit","error"),t(null)):((0,ex.v5)(s,"You have tried using a file type that will not work for your profile image","error"),t(null))},d=(0,l.useState)(!1),u=d[0],x=d[1],p=(0,l.useRef)(null),h=function(e){e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?x(!0):"dragleave"===e.type&&x(!1)},m=function(e){e.preventDefault(),e.stopPropagation(),x(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&c(e.dataTransfer.files)},j=function(e){e.preventDefault(),e.target.files&&e.target.files[0]&&c(e.target.files)},f=function(){p&&p.current.click()};return(0,a.jsxs)("form",{id:"form-file-upload",onDragEnter:h,onSubmit:function(e){e.preventDefault(),o()},children:[(0,a.jsx)("input",{ref:p,accept:ep.join(","),type:"file",id:"input-file-upload",onChange:j}),(0,a.jsxs)("label",{id:"label-file-upload",htmlFor:"input-file-upload",className:u?"drag-active":"",children:[(0,a.jsx)(el.Z,{src:"upload.svg",alt:"upload"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,a.jsx)("button",{className:"upload-button",onClick:f,type:"button",children:"Click to upload"}),(0,a.jsx)("p",{style:{margin:0},children:"or drag and drop"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{style:{fontSize:"0.875rem",margin:0},children:"SVG, PNG, JPG or GIF (max. 1MB)"})})]}),u&&(0,a.jsx)("div",{id:"drag-file-element",onDragEnter:h,onDragLeave:h,onDragOver:h,onDrop:m}),(0,a.jsx)(v.Nw,{onCancel:n})]})},em=r(36005),ej=(0,eu.qn)(Z.YA),ef=function(){var e=(0,V.x)(),n=(0,l.useState)(),r=n[0],o=n[1],c=(0,l.useState)(!0),d=c[0],u=c[1],x=(0,$.d)(),p=(0,l.useState)(!1),h=p[0],m=p[1],j=(0,w.Z)((0,K.P)(void 0,void 0,{onError:function(){return(0,ex.v5)(x,"Failed to update user profile","error")},onSuccess:function(){return(0,ex.v5)(x,"Successfully updated user profile","success")}}),2),f=j[0],b=j[1].isLoading,v=(0,l.useState)(),Z=(v[0],v[1]),y=(0,l.useState)(!1),_=y[0],P=y[1],k=(0,l.useState)(!1),S=k[0],R=k[1];(0,l.useEffect)(function(){e.getOne("users",{id:ej}).then(function(e){o(e.data),u(!1)}).catch(function(e){Z(e),u(!1)})},[]);var E,D=function(){P(!1)},T=(E=(0,i.Z)(function(e){var n,r,i,a,l,o,c;return(0,s.__generator)(this,function(s){return n=e.referred_by_id,r=e.first_name,i=e.last_name,a=e.id,l=e.email,o=(0,em.CE)(e,["__typename","id","createtime","referred_by_other","state","zipcode"]),f("role",{data:{tenantid:14,login:l,name:"".concat(r," ").concat(i)},id:a},{onError:function(){return(0,ex.v5)(x,"Failed to update the role","error")},onSuccess:function(){return(0,ex.v5)(x,"Successfully updated role","success")}}),f("users",{data:(0,C.Z)((0,t.Z)({},o),{id:ej,referred_by_id:n||null}),id:ej}),[2]})}),function(e){return E.apply(this,arguments)}),W=function(){setTimeout(function(){m(!0)},0)};return d||!r?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(et.Z,{open:_,onClose:function(){return P(!1)},"aria-labelledby":"form-dialog-title",children:[(0,a.jsx)(es.Z,{id:"form-dialog-title",sx:{p:3.75,pb:2},children:"Change Password"}),(0,a.jsx)(ea.Z,{sx:{p:"16px!important"},children:(0,a.jsx)(ed.GR,{onCancel:D,user:r})})]}),(0,a.jsxs)(et.Z,{open:S,onClose:function(){return R(!1)},"aria-labelledby":"profile-image-upload",children:[(0,a.jsx)(es.Z,{id:"profile-image-upload",children:"Update Profile Image"}),(0,a.jsx)(ea.Z,{children:(0,a.jsx)(eh,{onCancel:function(){return R(!1)}})})]}),(0,a.jsxs)(ei.Z,{sx:{width:{xs:300,sm:450,md:500,lg:600,xl:600},p:4},children:[(0,a.jsxs)(Y.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(I.Z,{color:"primary",component:"h5",variant:"h5",align:"left",children:"Profile"}),(0,a.jsxs)(L.Z,{sx:{p:0,position:"relative","& .MuiAvatar-img":{filter:"grayscale(0) blur(0)",transition:".3s ease-in-out"},"& .MuiTypography-root":{opacity:0},"&:hover .MuiTypography-root":{opacity:1},"&:hover .MuiAvatar-img":{filter:"grayscale(100%) blur(1px)",opacity:.8},borderRadius:"50%"},"aria-controls":"endpoint-menu",onClick:function(){return R(!0)},children:[(0,a.jsx)(el.Z,{alt:"Remy Sharp",src:"avatar.svg",sx:{width:67,height:67}}),(0,a.jsx)(I.Z,{variant:"caption",color:"common.white",sx:{textDecoration:"underline",cursor:"pointer",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontWeight:"500"},children:"Change"})]})]}),(0,a.jsxs)(B.l,{record:r,onSubmit:T,children:[(0,a.jsxs)(eo.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(eo.ZP,{item:!0,sm:12,md:6,children:(0,a.jsx)(q.o,{margin:"normal",source:"first_name",validate:(0,g.i0)("First Name"),fullWidth:!0,disabled:!h})}),(0,a.jsx)(eo.ZP,{item:!0,sm:12,md:6,children:(0,a.jsx)(q.o,{margin:"normal",source:"last_name",validate:(0,g.i0)("Last Name"),fullWidth:!0,disabled:!h})})]}),(0,a.jsxs)(eo.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(eo.ZP,{item:!0,sm:7,children:(0,a.jsx)(q.o,{margin:"normal",source:"email",fullWidth:!0,validate:[(0,g.i0)("Email"),(0,ee.Do)()],disabled:!h})}),(0,a.jsx)(eo.ZP,{item:!0,sm:5,children:(0,a.jsx)(q.o,{margin:"normal",source:"phone",fullWidth:!0,disabled:!h})})]}),(0,a.jsxs)(eo.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(eo.ZP,{item:!0,sm:12,md:7,children:(0,a.jsx)(q.o,{margin:"normal",source:"company_name",fullWidth:!0,disabled:!h})}),(0,a.jsx)(eo.ZP,{item:!0,sm:12,md:5,children:(0,a.jsx)(en.D,{margin:"normal",source:"company_size_id",reference:"company_size",children:(0,a.jsx)(er.l,{margin:"normal",label:"Company Size",optionText:"value",disabled:!h,fullWidth:!0})})})]}),(0,a.jsx)(Y.Z,{direction:"row",spacing:2,justifyContent:"flex-end",children:(0,a.jsxs)(I.Z,{align:"right",children:[h?(0,a.jsx)(ec.Z,{type:"submit",color:"primary","aria-label":"edit_profile",sx:{letterSpacing:"0.5px",mr:1},disabled:b||d,children:"Save Changes"}):(0,a.jsx)(ec.Z,{type:"button",color:"primary","aria-label":"edit_profile",sx:{letterSpacing:"0.5px",mr:1},onClick:W,children:"Edit Profile"}),(0,a.jsx)(ec.Z,{variant:"outlined",color:"primary","aria-label":"change_password",onClick:function(){return P(!0)},sx:{borderRadius:3.75,py:.5,letterSpacing:"0.5px"},children:"Change Password"})]})})]})]})]})},eg=r(49837),eb=r(91359),ev=r(69466),eZ=function(){return(0,a.jsxs)(eg.Z,{children:[(0,a.jsx)(ev.D,{title:"Settings"}),(0,a.jsx)(eb.Z,{children:"Testing Settings"})]})},ey=r(37253),e_=function(){var e,n,r=null!==(e=(0,eu.qn)(Z.Zk))&&void 0!==e?e:"",t=(0,eu.qn)(Z.LA);return(0,a.jsx)(ey.ZP,{fetcher:(n=(0,i.Z)(function(e){var n;return(0,s.__generator)(this,function(i){switch(i.label){case 0:return[4,fetch(r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:t?"Bearer ".concat(t):""},body:JSON.stringify(e),credentials:"same-origin"})];case 1:return[2,(n=i.sent()).json().catch(function(){return n.text()})]}})}),function(e){return n.apply(this,arguments)})})},eC=r(22365),ew=r(25889),eP=r(59227),ek=r(79655),eS=r(18531),eR=r(85625),eE=r(46895),eD=r(96540),eT=function(e,n){return(0,a.jsx)(ek.rU,{to:e,children:n})},eW=function(e){return(0,a.jsxs)(Y.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",sx:{minWidth:"140px "},children:[(0,a.jsx)(eD.Z,{}),(0,a.jsx)(I.Z,{variant:"subtitle1",children:e.name})]})},eA=[{icon:eT("/database/create/internal",(0,a.jsx)(eW,{name:"Devii-hosted"})),name:"Devii-hosted",operation:"internal"},{icon:eT("/database/create",(0,a.jsx)(eW,{name:"Externally-hosted"})),name:"Externally-hosted",operation:"external"},],eL=function(){var e=(0,l.useState)(!1),n=e[0],r=e[1],i=function(){return r(!0)},t=function(){return r(!1)};return(0,a.jsx)(eS.Z,{ariaLabel:"Create Database",icon:(0,a.jsx)(eR.Z,{}),onClose:t,onOpen:i,open:n,children:eA.map(function(e){return(0,a.jsx)(eE.Z,{icon:e.icon,sx:{"& .MuiSpeedDialAction-staticTooltipLabel":{fontSize:"0.875rem"}},onClick:t},e.name)})})},eN=r(21448),eI=r(18488),ez=r(20640),eO=r.n(ez),eM=function(e){console.log(e),console.log("editHandler")},eF=function(e){var n,r,i=e.database,t=e.doubleClick,s=e.platform,o=e.environment,c=e.copyable,d=(0,m.Z)(),u=(0,$.d)(),x=(0,w.Z)(l.useState(null),2),j=x[0],f=x[1],g=(0,p.TH)(),b=(0,p.s0)(),y=function(e){f(e.currentTarget)},_=function(){f(null)},C=function(e){_();var n="".concat(Z.wb,"/tenant").concat(i.tenantid,"/").concat(e);eO()(n),u("Successfully copied to clipboard",{type:"success"})},P=function(e){t&&2===e.detail&&b("".concat(g.pathname,"/database/").concat(i.id))};return(0,a.jsxs)(eo.ZP,{item:!0,children:[(0,a.jsxs)(v.x0,{height:"270px",width:"270px",onClick:P,sx:{p:3.75,position:"relative",cursor:t?"pointer":"inherit"},children:[(0,a.jsxs)(Y.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:1,children:[(0,a.jsx)(I.Z,{color:"primary",component:"h5",variant:"h5",align:"left",display:"block",gutterBottom:!0,children:i.name}),(0,a.jsx)(v.XM,{title:"Configure",placement:"bottom",children:(0,a.jsx)(L.Z,{sx:{p:0,color:"background.light","&.MuiIconButton-root":{background:"transparent"}},onClick:function(){return eM(i.id)},children:(0,a.jsx)(eI.dY,{value:i.id,align:"right",sx:{color:"text.secondary",cursor:"pointer"}})})})]}),(0,a.jsx)(Y.Z,{sx:{minHeight:"40px",mb:d.spacing(1)},children:(0,a.jsx)(I.Z,{component:"p",variant:"body2",align:"left",display:"block",gutterBottom:!0,sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:"4",WebkitBoxOrient:"vertical"},children:i.description})}),(0,a.jsxs)(Y.Z,{direction:"row",spacing:1,children:[s&&(0,a.jsx)(h.Z,{component:"div",children:(n=i.database_platform_id,1===n?(0,a.jsx)(eN.Z,{label:"Internal",color:"success"}):(0,a.jsx)(eN.Z,{label:"External",color:"info"}))}),o&&(0,a.jsx)(h.Z,{component:"div",children:(r=i.database_env_id,1===r?(0,a.jsx)(eN.Z,{label:"Staging",color:"warning"}):(0,a.jsx)(eN.Z,{label:"Production",color:"primary"}))})]}),c&&(0,a.jsxs)(Y.Z,{direction:"row",justifyContent:"flex-end",sx:{position:"absolute",bottom:d.spacing(1),right:d.spacing(1),"&:hover":{cursor:"pointer"}},onClick:y,children:[(0,a.jsx)(I.Z,{color:"primary",component:"p",variant:"subtitle1",align:"right",display:"block",children:"ENDPOINTS"}),(0,a.jsx)(eI.TI,{component:"a",sx:{ml:1,cursor:"pointer"},color:"primary"})]})]}),(0,a.jsxs)(N.Z,{anchorEl:j,open:Boolean(j),onClose:_,children:[(0,a.jsx)(A.Z,{onClick:function(){return C(Z.Zk)},children:"Query"}),(0,a.jsx)(A.Z,{onClick:function(){return C(Z.pv)},children:"Roles_PBAC"})]})]},i.id)};eF.defaultProps={database:{},doubleClick:!0,platform:!0,environment:!0,copyable:!0};var eB,eq=function(){var e=(0,eP.Y)("database",{pagination:{page:1,perPage:100},sort:{field:"published_at",order:"DESC"}}),n=e.data,r=(e.total,e.isLoading),i=e.error;return r?(0,a.jsx)(v.JH,{}):i?(0,a.jsx)("p",{children:"ERROR"}):(0,a.jsxs)(eo.ZP,{container:!0,spacing:2,sx:{pt:1.5,justifyContent:{xs:"center",sm:"flex-start"}},children:[null==n?void 0:n.map(function(e){return(0,a.jsx)(eF,{database:e},e.id)}),(0,a.jsx)(eo.ZP,{item:!0,sx:{width:"270px",height:"270px"},children:(0,a.jsx)(eL,{})},"create_database")]})},eH={list:eq,create:function(e){var n=(0,p.s0)(),r=function(){n("/",{replace:!0})};return(0,a.jsxs)(v.x0,{sx:{width:{xs:300,sm:450,md:500,lg:600,xl:600},p:4},children:[(0,a.jsxs)(I.Z,{color:"primary",component:"h5",variant:"h5",align:"left",children:["Configure ",e.isExternal?"External":"Internal"," Database"]}),(0,a.jsxs)(B.l,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(q.o,{margin:"normal",label:"Name",source:"name",required:!0,fullWidth:!0}),(0,a.jsx)(q.o,{margin:"normal",label:"Description",source:"description",required:!0,fullWidth:!0}),(0,a.jsx)(en.D,{source:"database_env_id",reference:"database_environments",children:(0,a.jsx)(er.l,{margin:"normal",label:"Environment",optionText:"environment",required:!0,fullWidth:!0})}),(0,a.jsx)(en.D,{source:"database_platform_id",reference:"database_platforms",children:(0,a.jsx)(er.l,{margin:"normal",label:"Platform",optionText:"platform",required:!0,fullWidth:!0})})]}),(0,a.jsx)(v.Nw,{onCancel:r})]})]})}},eJ=r(45028),eY=function(){var e,n=(0,p.TH)(),r=null===(e=(0,P.LX)("project/database/:id",n.pathname))||void 0===e?void 0:e.params.id,i=(0,eJ.E)("database",{id:r}),t=i.data;return i.isLoading?(0,a.jsx)(v.JH,{}):(0,a.jsx)(eo.ZP,{container:!0,spacing:2,sx:{pt:1.5,justifyContent:{xs:"center",sm:"flex-start"}},children:(0,a.jsx)(eF,{database:t,doubleClick:!1})})},eG=r(98890),eX=r(88912),eU=r(87403),eQ=r(16774),eV=r(63009),e$=r(14924),eK=r(78740),e0=r(22841),e1=r(54181),e5=r(58316),e2=r(54048),e4=function(e){var n=e.action,r=e.isLoading,i=e.databaseTables,s=e.onCancel,o=(0,k.j)(),c=(0,l.useState)({name:"",global:!1}),d=c[0],u=c[1],x=function(e){return function(n){var r=n.target,i=r.value,s=r.checked;"global"===e?u(function(n){return(0,C.Z)((0,t.Z)({},n),(0,e$.Z)({},e,s))}):u(function(n){return(0,C.Z)((0,t.Z)({},n),(0,e$.Z)({},e,i))})}},p=function(e){var r=e.filter,i=e.capabilities,t=e.classes,s=e.roles,a=e.targets,l=e.name,o=e.id;n("policy_rule",{data:{name:l,targets:a,roles:d.global?[]:s||[],classes:d.global?[]:t||[],capabilities:i,filter:r?r.trim():null},id:o})};return(0,l.useEffect)(function(){u(function(e){return(0,C.Z)((0,t.Z)({},e),{global:!!o&&!o.classes.length&&!o.roles.length})})},[o]),(0,a.jsx)(B.l,{onSubmit:p,children:(0,a.jsxs)(h.Z,{component:"div",sx:{px:2},children:[(0,a.jsx)(eo.ZP,{container:!0,sx:{mb:2},children:(0,a.jsx)(eo.ZP,{item:!0,xs:12,md:7,children:(0,a.jsx)(q.o,{label:"Description",source:"name",fullWidth:!0,multiline:!0,maxRows:4,validate:[(0,g.i0)("Description")],inputProps:{maxLength:2048},helperText:d.name.length?"".concat(2048-d.name.length,"/").concat(2048," characters remaining"):"",disabled:r,onChange:x("name")})})}),(0,a.jsxs)(Y.Z,{direction:"row",spacing:6,children:[(0,a.jsx)(I.Z,{variant:"h5",children:"Logic"}),(0,a.jsx)(e0.Z,{control:(0,a.jsx)(e1.Z,{checked:d.global,disabled:r,onChange:x("global"),inputProps:{"aria-label":"controlled"}}),label:"Global"})]}),(0,a.jsxs)(eo.ZP,{container:!0,spacing:{xs:0,md:5},children:[(0,a.jsx)(eo.ZP,{item:!0,xs:12,md:6,children:(0,a.jsxs)(Y.Z,{direction:"row",alignItems:"center",spacing:5,children:[(0,a.jsx)(H.u,{source:"classes",reference:"role_class",children:(0,a.jsx)(v.C7,(0,t.Z)({disabled:d.global||r,margin:"normal",label:"Role Classes",sx:{width:"100%",".MuiSelect-select":{pt:"16.5px",pb:"16.5px"}},color:"info"},d.global?{}:{validate:g._5}))}),(0,a.jsx)(e5.Z,{sx:{color:"common.white",minWidth:70},children:(0,a.jsx)(I.Z,{variant:"h6",children:"and / or"})})]})}),(0,a.jsx)(eo.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(H.u,{source:"roles",reference:"role",children:(0,a.jsx)(v.C7,{disabled:d.global||r,margin:"normal",label:"Roles",optionText:"name",sx:{width:"100%",".MuiSelect-select":{pt:"16.5px",pb:"16.5px"}},color:"success"})})})]}),(0,a.jsxs)(eo.ZP,{container:!0,spacing:5,children:[(0,a.jsx)(eo.ZP,{item:!0,xs:12,md:5,children:(0,a.jsxs)(Y.Z,{direction:"row",alignItems:"center",spacing:3,children:[(0,a.jsx)(e5.Z,{sx:{color:"common.white",width:50},children:(0,a.jsx)(I.Z,{variant:"h6",children:"may"})}),(0,a.jsx)(H.u,{source:"capabilities",reference:"capability",filter:{defaultFilter:"subset = 'crud'"},children:(0,a.jsx)(v.C7,{disabled:r,margin:"normal",label:"Operations",optionText:"id",sx:{width:"100%",".MuiSelect-select":{pt:"16.5px",pb:"16.5px"}},color:"warning",validate:[(0,g.i0)("Operations")]})})]})}),(0,a.jsx)(eo.ZP,{item:!0,xs:12,md:7,children:(0,a.jsxs)(Y.Z,{direction:"row",alignItems:"center",spacing:5,children:[(0,a.jsx)(e5.Z,{sx:{color:"common.white",width:50},children:(0,a.jsx)(I.Z,{variant:"h6",children:"on"})}),(0,a.jsx)(v.C7,{disabled:r,margin:"normal",label:"Targets",source:"targets",optionText:"name",sx:{width:"100%",".MuiSelect-select":{pt:"16.5px",pb:"16.5px"}},choices:i,color:"error",validate:[(0,g.i0)("Targets")]})]})})]}),(0,a.jsxs)(Y.Z,{direction:"row",spacing:4,alignItems:"center",sx:{mt:2},children:[(0,a.jsx)(e5.Z,{sx:{color:"common.white"},children:(0,a.jsx)(I.Z,{variant:"h6",children:"if"})}),(0,a.jsx)(q.o,{disabled:r,label:"Filter Expression",source:"filter",fullWidth:!0,multiline:!0,minRows:3,maxRows:8,validate:(0,g.sp)("Filter expression")})]}),(0,a.jsxs)(Y.Z,{direction:"row",justifyContent:{xs:"center",sm:"space-between"},alignItems:"center",flexWrap:"wrap",children:[(0,a.jsx)(eK.r,{to:"/expression",target:"blank",sx:{textDecoration:"underline!important"},children:(0,a.jsxs)(I.Z,{variant:"subtitle1",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:["Expression language documentation",(0,a.jsx)(e2.Z,{sx:{width:16,ml:.4,mb:.1}})]})}),(0,a.jsx)(v.Nw,{onCancel:s,isLoading:r})]})]})})},e6=r(70270),e8=r(95509),e7=function(){var e=JSON.parse((0,eu.qn)(Z.Yi));return e?null==e?void 0:e.types.filter(function(e){return"Query"===e.name})[0].fields.filter(function(e){return"LIST"===e.type.kind}).map(function(e){return{id:e.name,name:e.name}}):[]},e3=function(){var e=(0,$.d)(),n=(0,eG.e)(),r=(0,eX.J)(),i=(0,p.TH)(),t=function(){n((0,e6.pO)(i.pathname).filter(function(e){return"Policy"===e.name})[0].link)},s=(0,w.Z)((0,eU.R)(void 0,void 0,{onError:function(){return(0,ex.v5)(e,"Failed to create policy rule","error")},onSuccess:function(){r(),(0,ex.v5)(e,"Successfully created","success",t)}}),2),l=s[0],o=s[1].isLoading;return(0,a.jsxs)(v.x0,{sx:{p:4},children:[(0,a.jsx)(I.Z,{color:"primary",component:"h5",variant:"h5",align:"left",children:"Add Policy Rule"}),(0,a.jsx)(eQ.Q,{resource:"policy_rule",children:(0,a.jsx)(e4,{action:l,isLoading:o,onCancel:t,databaseTables:e7()})}),o&&(0,a.jsx)(v.JH,{})]})},e9=function(){var e=(0,$.d)(),n=(0,eG.e)(),r=(0,eX.J)(),i=(0,p.TH)(),t=function(){n((0,e6.pO)(i.pathname).filter(function(e){return"Policy"===e.name})[0].link)},s=(0,l.useMemo)(function(){var e;return null===(e=(0,P.LX)(e8.Z.filter(function(e){return"Edit Policy Rule"===e.name})[0].path,i.pathname))||void 0===e?void 0:e.params.id},[i.pathname]),o=(0,w.Z)((0,K.P)(void 0,void 0,{onError:function(){return(0,ex.v5)(e,"Failed to update policy rule","error")},onSuccess:function(){r(),(0,ex.v5)(e,"Successfully updated","success",t)}}),2),c=o[0],d=o[1].isLoading;return(0,a.jsxs)(v.x0,{sx:{p:4},children:[(0,a.jsx)(I.Z,{color:"primary",component:"h5",variant:"h5",align:"left",children:"Edit Policy Rule"}),(0,a.jsx)(eV.I,{resource:"policy_rule",id:s,children:(0,a.jsx)(e4,{action:c,isLoading:d,onCancel:t,databaseTables:e7()})}),d&&(0,a.jsx)(v.JH,{})]})},ne=r(55743),nn=r(32490),nr=function(e){var n=e.record,r=n.capabilities,i=n.classes,t=n.roles,s=n.targets,o=n.filter,c=(0,l.useMemo)(function(){var e;if(!o)return 0;return(o.match(/AND/gi)||[]).length+(o.match(/OR/gi)||[]).length+1},[o]);return(0,a.jsxs)(Y.Z,{direction:"row",spacing:1,justifyContent:"space-around",children:[(0,a.jsx)(v.sZ,{label:(0,a.jsxs)("span",{children:["Role Classes ",(0,a.jsx)(L.Z,{children:i.length})]}),disabled:!i.length,color:"info"}),(0,a.jsx)(v.sZ,{label:(0,a.jsxs)("span",{children:["Roles ",(0,a.jsx)(L.Z,{children:t.length})]}),disabled:!t.length,color:"success"}),(0,a.jsx)(v.sZ,{label:(0,a.jsxs)("span",{children:["Operations ",(0,a.jsx)(L.Z,{children:r.length})]}),disabled:!r.length,color:"warning"}),(0,a.jsx)(v.sZ,{label:(0,a.jsxs)("span",{children:["Targets ",(0,a.jsx)(L.Z,{children:s.length})]}),disabled:!s.length,color:"error"}),(0,a.jsx)(v.sZ,{label:(0,a.jsxs)("span",{children:["Expressions ",(0,a.jsx)(L.Z,{children:c})]}),disabled:!c,color:"secondary"})]})},ni=r(41733),nt=r(85982),ns=r(47600),na=function(){var e=(0,p.s0)();(0,p.TH)();var n,r=(0,k.j)(),t=(0,$.d)(),o=(0,l.useState)(!1),c=o[0],d=o[1],u=function(){return d(!1)},x=(0,w.Z)((0,nt.R)(void 0,void 0,{onError:function(){return(0,ex.v5)(t,"Failed to delete","error",u)},onSuccess:function(){return(0,ex.v5)(t,"Successfully deleted","success",u)}}),2),h=x[0],m=x[1].isLoading,j=(n=(0,i.Z)(function(){return(0,s.__generator)(this,function(e){return h(r.__typename,{id:r.id,previousData:r}),[2]})}),function(){return n.apply(this,arguments)});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.r6,{options:[{action:function(){return e("".concat(r.id),{replace:!0})},title:"Edit Policy Rule"},{action:function(){return d(!0)},title:"Delete Policy Rule"},]}),(0,a.jsx)(ns.I,{isOpen:c,loading:m,title:"Delete Policy Rule",content:"Are you sure you want to delete this Policy Rule?",confirm:"Delete",ConfirmIcon:ni.Z,onConfirm:j,onClose:function(){return d(!1)}})]})},nl=function(){var e=(0,eP.Y)("policy_rule"),n=e.data,r=e.isLoading,i=(0,ne.s)({data:n,isLoading:r});return(0,a.jsx)(nn.D,{value:i,children:r?(0,a.jsx)(v.JH,{}):(0,a.jsxs)(v.x0,{sx:{p:4},children:[(0,a.jsx)(I.Z,{variant:"h5",color:"primary",children:"Policy Rules"}),(0,a.jsx)(S.a,{actions:(0,a.jsx)(v.RY,{refresh:!1,export:!1,title:"Policy Rule",filters:{main:"name"}}),resource:"policy_rule",children:(0,a.jsxs)(R.c,{optimized:!0,bulkActionButtons:!1,sx:{"& .RaDatagrid-thead":{display:"none"}},children:[(0,a.jsx)(E.n,{source:"name",label:"Name",sx:{whiteSpace:"nowrap"}}),(0,a.jsx)(D.J,{label:"",render:function(e){return(0,a.jsx)(nr,{record:e})}}),(0,a.jsx)(na,{})]})})]})})},no=function(){var e,n,r=(0,l.useState)(null),C=r[0],w=r[1],P=(0,j.x)(),k=(0,y.Uk)(Z.pv),S=(0,m.Z)();return(0,l.useEffect)(function(){var e;(e=(0,i.Z)(function(){var e;return(0,s.__generator)(this,function(n){switch(n.label){case 0:return[4,f.b.checkAuth(null).catch(function(){console.log("Not Auth")})];case 1:return n.sent(),e=(0,o.u)(function(e){switch(e){case"users":case"temp_registration":case"invites":case"company_size":case"referred_by":case"database":case"database_platforms":case"database_environments":case"user_types":case"user_password_reset_requests":return(0,g.lh)(P);case"role":case"role_class":case"policy_rule":case"tenant":case"capability":return(0,g.MN)(k);default:throw Error("Unknown resource: ".concat(e))}}),w(function(){return e}),[2]}})}),function(){return e.apply(this,arguments)})()},[]),(0,a.jsx)(h.Z,{sx:{backgroundColor:"".concat(null===(e=S.palette)||void 0===e?void 0:null===(n=e.background)||void 0===n?void 0:n.default),height:"100vh"},children:C?(0,a.jsxs)(c.w,{authProvider:f.b,dataProvider:C,theme:S,layout:b.A,loginPage:eC.X,notification:ew.Z,requireAuth:!0,children:[(0,a.jsx)(d._,(0,t.Z)({name:"project"},eH)),(0,a.jsx)(d._,(0,t.Z)({name:"users"},_.Z)),(0,a.jsx)(d._,{name:"invites",list:u.i}),(0,a.jsx)(d._,{name:"role",list:u.i}),(0,a.jsx)(d._,{name:"role_class",list:u.i}),(0,a.jsx)(d._,{name:"/project/database/:id/policy_rule",list:nl}),(0,a.jsx)(d._,{name:"tenant",list:u.i}),(0,a.jsxs)(x.G,{children:[(0,a.jsx)(p.AW,{path:"/project",element:(0,a.jsx)(eq,{})}),(0,a.jsx)(p.AW,{path:"/project/database/:id",element:(0,a.jsx)(eY,{})}),(0,a.jsx)(p.AW,{path:"/project/database/:id/policy_rule/:id",element:(0,a.jsx)(e9,{})}),(0,a.jsx)(p.AW,{path:"/project/database/:id/policy_rule/create",element:(0,a.jsx)(e3,{})}),(0,a.jsx)(p.AW,{path:"/role_management",element:(0,a.jsx)(Q,{})}),(0,a.jsx)(p.AW,{path:"/role_management/role/:id",element:(0,a.jsx)(Q,{})}),(0,a.jsx)(p.AW,{path:"/role_management/role_class/:id",element:(0,a.jsx)(Q,{})}),(0,a.jsx)(p.AW,{path:"/settings",element:(0,a.jsx)(eZ,{})}),(0,a.jsx)(p.AW,{path:"/profile",element:(0,a.jsx)(ef,{})}),(0,a.jsx)(p.AW,{path:"/graphiql",element:(0,a.jsx)(e_,{})})]})]}):(0,a.jsx)(v.JH,{color:"primary"})})}}}]);